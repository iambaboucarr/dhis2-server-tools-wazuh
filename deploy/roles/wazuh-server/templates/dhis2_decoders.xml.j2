<!-- DHIS2 Log Decoders -->

<!-- DHIS2 Standard Log Format -->
<decoder name="dhis2">
  <prematch>^\* INFO|^\* WARN|^\* ERROR|^\* DEBUG</prematch>
</decoder>

<decoder name="dhis2-fields">
  <parent>dhis2</parent>
  <regex>^\* (\S+) \S+ (\S+) \[(\S+)\] \((\S+)\)</regex>
  <order>level, timestamp, module, user</order>
</decoder>

<!-- DHIS2 Audit Log Format -->
<decoder name="dhis2-audit">
  <prematch type="pcre2">^\d{4}-\d{2}-\d{2}.*AUDIT</prematch>
</decoder>

<decoder name="dhis2-audit-fields">
  <parent>dhis2-audit</parent>
  <regex>^(\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}) \S+ \[(\S+)\] AUDIT: (\S+) (\S+) (\S+)</regex>
  <order>timestamp, user, action, object_type, object_id</order>
</decoder>

<!-- DHIS2 Security Events -->
<decoder name="dhis2-security">
  <prematch>Authentication|Login|Access denied|Permission</prematch>
</decoder>

<decoder name="dhis2-security-fields">
  <parent>dhis2-security</parent>
  <regex>(\S+) for user '(\S+)' from IP (\S+)</regex>
  <order>action, user, srcip</order>
</decoder>

<!-- DHIS2 API Access -->
<decoder name="dhis2-api">
  <prematch>/api/</prematch>
</decoder>

<decoder name="dhis2-api-fields">
  <parent>dhis2-api</parent>
  <regex>(\S+) (/api/\S+) .* (\d{3}) .* (\S+)$</regex>
  <order>method, url, status, user</order>
</decoder>

<!-- DHIS2 Data Import/Export -->
<decoder name="dhis2-data">
  <prematch>Import|Export|Data exchange</prematch>
</decoder>

<decoder name="dhis2-data-fields">
  <parent>dhis2-data</parent>
  <regex>(\S+) (\d+) records .* by (\S+)</regex>
  <order>action, count, user</order>
</decoder>

<!-- LXD Log Decoder -->
<decoder name="lxd">
  <prematch type="pcre2">\blxd\b|\bLXD\b|container</prematch>
</decoder>

<decoder name="lxd-json">
  <parent>lxd</parent>
  <prematch>^{</prematch>
  <plugin_decoder>JSON_Decoder</plugin_decoder>
</decoder>

<decoder name="lxd-container">
  <parent>lxd</parent>
  <regex>container (\S+) (\S+)</regex>
  <order>container_name, action</order>
</decoder>