version: '3.8'

services:
  dhis2-test-env:
    image: ubuntu:22.04
    container_name: dhis2-wazuh-test
    privileged: true
    volumes:
      - ../deploy:/opt/dhis2-deploy:ro
      - ./:/opt/test:ro
      - /sys/fs/cgroup:/sys/fs/cgroup:rw
    ports:
      - "8080:80"
      - "8443:443"
      - "2222:22"
    networks:
      - dhis2-test-net
    environment:
      - DEBIAN_FRONTEND=noninteractive
    command: /sbin/init
    healthcheck:
      test: ["CMD", "systemctl", "is-active", "ssh"]
      interval: 30s
      timeout: 10s
      retries: 3
    cap_add:
      - SYS_ADMIN
    security_opt:
      - apparmor:unconfined

networks:
  dhis2-test-net:
    driver: bridge
    ipam:
      config:
        - subnet: 172.20.0.0/16